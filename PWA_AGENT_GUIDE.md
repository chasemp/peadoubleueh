# PWA Agent Guide - Critical Information for AI Agents

**🚨 READ THIS FIRST** - Essential patterns to avoid common mistakes

---

## 🎯 **CRITICAL: File Structure & Build Flow**

### **The #1 Confusion Point: Where to Edit Files**

```
❌ WRONG ASSUMPTION: /src → /docs
✅ CORRECT FLOW: 
   /src → /docs (processed files: HTML, JS, CSS, TypeScript)
   /public → /docs (static files: copied as-is)
```

### **Real Example: CannonPop Game File Confusion**

An agent discovered **THREE copies** of the same file:
```bash
❌ /src/game-legacy.js        # WRONG! Doesn't get deployed
✅ /public/game-legacy.js     # CORRECT! Gets copied to /docs  
📦 /docs/game-legacy.js       # Build output (auto-generated)
```

**The Critical Mistake:**
- Agent edited `/src/game-legacy.js` 
- Build copies `/public/game-legacy.js` → `/docs/game-legacy.js`
- Changes to `/src/game-legacy.js` were **completely ignored**!

### **Decision Tree: Where Does This File Go?**

```
Is this file processed by build tools (Vite/Webpack)?
├─ YES (HTML, JS, CSS, TypeScript, Svelte, React)
│  └─ Put in /src/
└─ NO (Images, JSON, libraries, static assets)
   └─ Put in /public/
```

**Examples:**
- ✅ `/src/main.js` - Your app logic (processed)
- ✅ `/src/App.svelte` - Component (processed)
- ✅ `/src/styles.css` - Your styles (processed)
- ✅ `/public/manifest.json` - PWA manifest (static)
- ✅ `/public/game-legacy.js` - Third-party library (static)
- ✅ `/public/images/logo.png` - Images (static)

---

## 🏗️ **Project Structure Pattern**

**Every PWA follows this pattern:**

```
project/
├── src/                    # 🔧 Source code (processed by build)
│   ├── index.html         # Entry point
│   ├── main.js           # App logic
│   ├── styles/           # CSS/SCSS
│   └── components/       # Components
├── public/               # 📁 Static assets (copied as-is)
│   ├── manifest.json     # PWA manifest
│   ├── CNAME            # GitHub Pages domain
│   ├── images/          # All images
│   └── libs/            # Third-party libraries
├── docs/                 # 📦 Build output (NEVER EDIT!)
├── package.json          # Dependencies & scripts
├── vite.config.js        # Build configuration
└── PWA_AGENT_GUIDE.md    # This file
```

---

## ⚡ **Quick Commands**

### **Development**
```bash
npm run dev        # Start dev server (usually port 3000-3456)
npm run build      # Build for production → /docs
npm run preview    # Preview production build
```

### **Deployment**
```bash
git add -A && git commit -m "your changes"
git push origin main    # Auto-deploys to GitHub Pages
```

### **Port Management** (Multi-PWA Development)
```bash
npm run port       # Check what's running on your port
npm run port:kill  # Kill process on your port
```

---

## 🚨 **Critical Rules - Never Break These**

### **1. Never Edit `/docs` Directory**
- ❌ **NEVER** edit files in `/docs/`
- ✅ **ALWAYS** edit source files in `/src/` or `/public/`
- 📦 `/docs/` is auto-generated by `npm run build`

### **2. Static Files Go in `/public`**
- ❌ Don't put images in `/src/images/`
- ✅ Put images in `/public/images/`
- ❌ Don't put libraries in `/src/libs/`
- ✅ Put libraries in `/public/libs/`

### **3. Check Your Changes Work**
```bash
# After making changes:
npm run build      # Build to /docs
git add -A         # Stage changes
git commit -m "description"
git push origin main
# Wait 1-2 minutes, then check the live site
```

### **4. Service Worker Debugging**
If the site isn't updating:
```bash
# In browser DevTools → Application → Service Workers
# Check "Update on reload"
# Or manually unregister service workers
```

---

## 🔍 **Debugging Common Issues**

### **"My changes aren't showing up!"**

**Check this in order:**

1. **Are you editing the right file?**
   ```bash
   # If it's a static file, should be in /public
   ls public/your-file.js  # Should exist
   ls src/your-file.js     # Should NOT exist (for static files)
   ```

2. **Did you build?**
   ```bash
   npm run build
   ```

3. **Did you commit and push?**
   ```bash
   git status              # Check what's staged
   git add -A && git commit -m "fix" && git push origin main
   ```

4. **Service worker caching?**
   - Hard refresh (Ctrl+Shift+R / Cmd+Shift+R)
   - Or disable cache in DevTools

### **"Port conflicts with other PWAs"**

Each PWA has a unique port:
- peadoubleueh: 3456
- CannonPop: 3002  
- MealPlanner: 3004
- Giffer: 3005

```bash
npm run port:check  # See what's running
npm run port:kill   # Kill your port
```

---

## 📱 **PWA-Specific Patterns**

### **Touch Events (Mobile)**
```javascript
// ❌ WRONG: Click only
element.addEventListener('click', handler);

// ✅ CORRECT: Universal touch/click
import EventHelper from './utils/EventHelper.js';
EventHelper.addUniversalHandler(element, handler);
```

### **Console Statements**
```javascript
// ❌ WRONG: Direct console
console.log('debug info');

// ✅ CORRECT: Conditional logging
import logger from './utils/Logger.js';
logger.log('debug info');  // Only shows in development
```

### **Asset References**
```html
<!-- ✅ CORRECT: Absolute paths for public assets -->
<img src="/images/logo.png" alt="Logo">
<link rel="manifest" href="/manifest.json">

<!-- ❌ WRONG: Relative paths to wrong locations -->
<img src="../image/logo.png" alt="Logo">
<img src="./src/assets/logo.png" alt="Logo">
```

---

## 🎯 **Success Checklist**

Before finishing any task:

- [ ] Files are in correct directories (`/src` vs `/public`)
- [ ] `npm run build` completes without errors
- [ ] Changes committed and pushed to main branch
- [ ] Live site updates within 2 minutes
- [ ] No console errors in browser DevTools
- [ ] Mobile touch events work (if interactive)
- [ ] Service worker updates properly

---

## 📚 **Full Documentation**

For complete guides, see:
- [PWA Development Lessons](./project-docs/PWA_DEVELOPMENT_LESSONS.md) - Start here
- [Quick Reference](./project-docs/PWA_QUICK_REFERENCE.md) - Code snippets
- [Deployment Architecture](./project-docs/DEPLOYMENT_ARCHITECTURE.md) - Deep dive

---

## 🆘 **When Things Go Wrong**

### **Nuclear Option: Fresh Start**
```bash
# Clear all caches and rebuild
rm -rf docs/
npm run build
git add -A && git commit -m "rebuild" && git push origin main
```

### **Service Worker Issues**
```javascript
// In browser console:
navigator.serviceWorker.getRegistrations().then(registrations => {
  registrations.forEach(registration => registration.unregister());
});
location.reload();
```

---

**Remember: When in doubt, check the live site after every change!**

**🌐 This project deploys to:** `https://[project-name].523.life/`
