# PWA Agent Guide - Critical Information for AI Agents

**ğŸš¨ READ THIS FIRST** - Essential patterns to avoid common mistakes

---

## ğŸ¯ **CRITICAL: File Structure & Build Flow**

### **The #1 Confusion Point: Where to Edit Files**

```
âŒ WRONG ASSUMPTION: /src â†’ /docs
âœ… CORRECT FLOW: 
   /src â†’ /docs (processed files: HTML, JS, CSS, TypeScript)
   /public â†’ /docs (static files: copied as-is)
```

### **Real Example: CannonPop Game File Confusion**

An agent discovered **THREE copies** of the same file:
```bash
âŒ /src/game-legacy.js        # WRONG! Doesn't get deployed
âœ… /public/game-legacy.js     # CORRECT! Gets copied to /docs  
ğŸ“¦ /docs/game-legacy.js       # Build output (auto-generated)
```

**The Critical Mistake:**
- Agent edited `/src/game-legacy.js` 
- Build copies `/public/game-legacy.js` â†’ `/docs/game-legacy.js`
- Changes to `/src/game-legacy.js` were **completely ignored**!

### **Decision Tree: Where Does This File Go?**

```
Is this file processed by build tools (Vite/Webpack)?
â”œâ”€ YES (HTML, JS, CSS, TypeScript, Svelte, React)
â”‚  â””â”€ Put in /src/
â””â”€ NO (Images, JSON, libraries, static assets)
   â””â”€ Put in /public/
```

**Examples:**
- âœ… `/src/main.js` - Your app logic (processed)
- âœ… `/src/App.svelte` - Component (processed)
- âœ… `/src/styles.css` - Your styles (processed)
- âœ… `/public/manifest.json` - PWA manifest (static)
- âœ… `/public/game-legacy.js` - Third-party library (static)
- âœ… `/public/images/logo.png` - Images (static)

---

## ğŸ—ï¸ **Project Structure Pattern**

**Every PWA follows this pattern:**

```
project/
â”œâ”€â”€ src/                    # ğŸ”§ Source code (processed by build)
â”‚   â”œâ”€â”€ index.html         # Entry point
â”‚   â”œâ”€â”€ main.js           # App logic
â”‚   â”œâ”€â”€ styles/           # CSS/SCSS
â”‚   â””â”€â”€ components/       # Components
â”œâ”€â”€ public/               # ğŸ“ Static assets (copied as-is)
â”‚   â”œâ”€â”€ manifest.json     # PWA manifest
â”‚   â”œâ”€â”€ CNAME            # GitHub Pages domain
â”‚   â”œâ”€â”€ images/          # All images
â”‚   â””â”€â”€ libs/            # Third-party libraries
â”œâ”€â”€ docs/                 # ğŸ“¦ Build output (NEVER EDIT!)
â”œâ”€â”€ package.json          # Dependencies & scripts
â”œâ”€â”€ vite.config.js        # Build configuration
â””â”€â”€ PWA_AGENT_GUIDE.md    # This file
```

---

## âš¡ **Quick Commands**

### **Development**
```bash
npm run dev        # Start dev server (usually port 3000-3456)
npm run build      # Build for production â†’ /docs
npm run preview    # Preview production build
```

### **Deployment**
```bash
git add -A && git commit -m "your changes"
git push origin main    # Auto-deploys to GitHub Pages
```

### **Port Management** (Multi-PWA Development)
```bash
npm run port       # Check what's running on your port
npm run port:kill  # Kill process on your port
```

---

## ğŸš¨ **Critical Rules - Never Break These**

### **1. Never Edit `/docs` Directory**
- âŒ **NEVER** edit files in `/docs/`
- âœ… **ALWAYS** edit source files in `/src/` or `/public/`
- ğŸ“¦ `/docs/` is auto-generated by `npm run build`

### **2. Static Files Go in `/public`**
- âŒ Don't put images in `/src/images/`
- âœ… Put images in `/public/images/`
- âŒ Don't put libraries in `/src/libs/`
- âœ… Put libraries in `/public/libs/`

### **3. Check Your Changes Work**
```bash
# After making changes:
npm run build      # Build to /docs
git add -A         # Stage changes
git commit -m "description"
git push origin main
# Wait 1-2 minutes, then check the live site
```

### **4. Service Worker Debugging**
If the site isn't updating:
```bash
# In browser DevTools â†’ Application â†’ Service Workers
# Check "Update on reload"
# Or manually unregister service workers
```

---

## ğŸ” **Debugging Common Issues**

### **"My changes aren't showing up!"**

**Check this in order:**

1. **Are you editing the right file?**
   ```bash
   # If it's a static file, should be in /public
   ls public/your-file.js  # Should exist
   ls src/your-file.js     # Should NOT exist (for static files)
   ```

2. **Did you build?**
   ```bash
   npm run build
   ```

3. **Did you commit and push?**
   ```bash
   git status              # Check what's staged
   git add -A && git commit -m "fix" && git push origin main
   ```

4. **Service worker caching?**
   - Hard refresh (Ctrl+Shift+R / Cmd+Shift+R)
   - Or disable cache in DevTools

### **"Port conflicts with other PWAs"**

Each PWA has a unique port:
- peadoubleueh: 3456
- CannonPop: 3002  
- MealPlanner: 3004
- Giffer: 3005

```bash
npm run port:check  # See what's running
npm run port:kill   # Kill your port
```

---

## ğŸ“± **PWA-Specific Patterns**

### **Touch Events (Mobile)**
```javascript
// âŒ WRONG: Click only
element.addEventListener('click', handler);

// âœ… CORRECT: Universal touch/click
import EventHelper from './utils/EventHelper.js';
EventHelper.addUniversalHandler(element, handler);
```

### **Console Statements**
```javascript
// âŒ WRONG: Direct console
console.log('debug info');

// âœ… CORRECT: Conditional logging
import logger from './utils/Logger.js';
logger.log('debug info');  // Only shows in development
```

### **Asset References**
```html
<!-- âœ… CORRECT: Absolute paths for public assets -->
<img src="/images/logo.png" alt="Logo">
<link rel="manifest" href="/manifest.json">

<!-- âŒ WRONG: Relative paths to wrong locations -->
<img src="../image/logo.png" alt="Logo">
<img src="./src/assets/logo.png" alt="Logo">
```

---

## ğŸ¯ **Success Checklist**

Before finishing any task:

- [ ] Files are in correct directories (`/src` vs `/public`)
- [ ] `npm run build` completes without errors
- [ ] Changes committed and pushed to main branch
- [ ] Live site updates within 2 minutes
- [ ] No console errors in browser DevTools
- [ ] Mobile touch events work (if interactive)
- [ ] Service worker updates properly

---

## ğŸ“š **Full Documentation**

For complete guides, see:
- [PWA Development Lessons](./project-docs/PWA_DEVELOPMENT_LESSONS.md) - Start here
- [Quick Reference](./project-docs/PWA_QUICK_REFERENCE.md) - Code snippets
- [Deployment Architecture](./project-docs/DEPLOYMENT_ARCHITECTURE.md) - Deep dive

---

## ğŸ†˜ **When Things Go Wrong**

### **Nuclear Option: Fresh Start**
```bash
# Clear all caches and rebuild
rm -rf docs/
npm run build
git add -A && git commit -m "rebuild" && git push origin main
```

### **Service Worker Issues**
```javascript
// In browser console:
navigator.serviceWorker.getRegistrations().then(registrations => {
  registrations.forEach(registration => registration.unregister());
});
location.reload();
```

---

**Remember: When in doubt, check the live site after every change!**

**ğŸŒ This project deploys to:** `https://[project-name].523.life/`
