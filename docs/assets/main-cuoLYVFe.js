(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function t(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(a){if(a.ep)return;a.ep=!0;const s=t(a);fetch(a.href,s)}})();class w{constructor(){this.isDev=localStorage.getItem("debug")==="true"||window.location.hostname==="localhost"||window.location.hostname.includes("127.0.0.1")}log(...e){this.isDev&&console.log(...e)}warn(...e){this.isDev&&console.warn(...e)}error(...e){console.error(...e)}info(e,...t){this.isDev&&console.log(e,...t)}success(...e){this.isDev&&console.log("‚úÖ",...e)}warning(...e){this.isDev&&console.warn("‚ö†Ô∏è",...e)}enableDebug(){localStorage.setItem("debug","true"),this.isDev=!0,this.log("üêõ Debug mode enabled")}disableDebug(){localStorage.removeItem("debug"),this.isDev=!1}}const i=new w;class v{constructor(){this.storageKey="pwa_template_data",this.settingsKey="pwa_template_settings",this.versionKey="pwa_template_version",this.currentVersion="1.0.0",this.defaultSettings={theme:"auto",notifications:!0,autoUpdate:!0,language:"en",debugMode:!1},this.isInitialized=!1}async initialize(){if(!this.isInitialized){i.log("üóÑÔ∏è Initializing Storage Manager...");try{await this.checkForMigration(),this.getSettings()||this.setSettings(this.defaultSettings),this.isInitialized=!0,i.log("‚úÖ Storage Manager initialized successfully")}catch(e){throw i.error("‚ùå Failed to initialize Storage Manager:",e),e}}}getSettings(){try{const e=localStorage.getItem(this.settingsKey);return e?JSON.parse(e):null}catch(e){return i.error("Failed to get settings:",e),null}}setSettings(e){try{const r={...this.getSettings()||{},...e};return localStorage.setItem(this.settingsKey,JSON.stringify(r)),!0}catch(t){return i.error("Failed to set settings:",t),!1}}updateSettings(e){const t=this.getSettings()||this.defaultSettings;return this.setSettings({...t,...e})}getItem(e,t=null){try{const r=localStorage.getItem(e);return r?JSON.parse(r):t}catch(r){return i.error(`Failed to get item ${e}:`,r),t}}setItem(e,t){try{return localStorage.setItem(e,JSON.stringify(t)),!0}catch(r){return i.error(`Failed to set item ${e}:`,r),!1}}removeItem(e){try{return localStorage.removeItem(e),!0}catch(t){return i.error(`Failed to remove item ${e}:`,t),!1}}getData(){return this.getItem(this.storageKey,{})}setData(e){return this.setItem(this.storageKey,e)}updateData(e){const t=this.getData();return this.setData({...t,...e})}clearData(){return this.removeItem(this.storageKey)}async checkForMigration(){const e=localStorage.getItem(this.versionKey);if(!e){localStorage.setItem(this.versionKey,this.currentVersion);return}e!==this.currentVersion&&(i.log(`üîÑ Migrating data from version ${e} to ${this.currentVersion}`),await this.migrateData(e,this.currentVersion),localStorage.setItem(this.versionKey,this.currentVersion))}async migrateData(e,t){const r={"1.0.0":()=>this.migrateToV1_0_0()};try{const a=this.getVersionNumbers(e,t);for(const s of a){const n=r[s];n&&(i.log(`Running migration for version ${s}`),await n())}i.log("‚úÖ Data migration completed successfully")}catch(a){i.error("‚ùå Data migration failed:",a)}}getVersionNumbers(e,t){const r=["1.0.0"],a=r.indexOf(e),s=r.indexOf(t);return a===-1||s===-1?(i.warn("Unknown version in migration"),[]):r.slice(a+1,s+1)}migrateToV1_0_0(){i.log("Running migration to v1.0.0");const e=localStorage.getItem("old_settings_key");if(e)try{const t=JSON.parse(e),r={theme:t.theme||"auto",notifications:t.notifications!==!1,autoUpdate:t.autoUpdate!==!1};this.setSettings(r),localStorage.removeItem("old_settings_key")}catch(t){i.error("Failed to migrate old settings:",t)}}getStorageUsage(){try{let e=0;for(let t in localStorage)localStorage.hasOwnProperty(t)&&(e+=localStorage[t].length+t.length);return e}catch(e){return i.error("Failed to calculate storage usage:",e),0}}getStorageQuota(){try{return"storage"in navigator&&"estimate"in navigator.storage?navigator.storage.estimate():null}catch(e){return i.error("Failed to get storage quota:",e),null}}async cleanupOldData(){try{const e=this.getData(),t=Date.now(),r=30*24*60*60*1e3,a={};for(const[s,n]of Object.entries(e))n.timestamp&&t-n.timestamp<r&&(a[s]=n);this.setData(a),i.log("‚úÖ Old data cleaned up")}catch(e){i.error("Failed to cleanup old data:",e)}}exportData(){try{const e={settings:this.getSettings(),data:this.getData(),version:this.currentVersion,exportDate:new Date().toISOString()},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),r=URL.createObjectURL(t),a=document.createElement("a");return a.href=r,a.download=`pwa-template-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r),!0}catch(e){return i.error("Failed to export data:",e),!1}}async importData(e){try{const t=await e.text(),r=JSON.parse(t);if(!r.version||!r.settings)throw new Error("Invalid backup file format");return r.settings&&this.setSettings(r.settings),r.data&&this.setData(r.data),i.log("‚úÖ Data imported successfully"),!0}catch(t){return i.error("Failed to import data:",t),!1}}getAllKeys(){const e=[];for(let t=0;t<localStorage.length;t++)e.push(localStorage.key(t));return e}clearAll(){try{return localStorage.clear(),i.log("‚úÖ All storage cleared"),!0}catch(e){return i.error("Failed to clear all storage:",e),!1}}}class k{constructor(){this.storageKey="pwa_template_theme",this.themes=["light","dark","auto"],this.currentTheme="auto",this.systemTheme="light",this.isInitialized=!1,this.themeChangeCallbacks=[],this.detectSystemTheme()}async initialize(){if(!this.isInitialized){i.log("üé® Initializing Theme Manager...");try{this.loadThemePreference(),this.applyTheme(),this.setupSystemThemeListener(),this.isInitialized=!0,i.log("‚úÖ Theme Manager initialized successfully")}catch(e){throw i.error("‚ùå Failed to initialize Theme Manager:",e),e}}}detectSystemTheme(){window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?this.systemTheme="dark":this.systemTheme="light"}setupSystemThemeListener(){window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{this.systemTheme=t.matches?"dark":"light",this.currentTheme==="auto"&&(this.applyTheme(),this.notifyThemeChange())})}loadThemePreference(){try{const e=localStorage.getItem(this.storageKey);e&&this.themes.includes(e)&&(this.currentTheme=e)}catch(e){i.error("Failed to load theme preference:",e)}}saveThemePreference(e){try{localStorage.setItem(this.storageKey,e)}catch(t){i.error("Failed to save theme preference:",t)}}setTheme(e){return this.themes.includes(e)?(this.currentTheme=e,this.saveThemePreference(e),this.applyTheme(),this.notifyThemeChange(),!0):(i.warn(`Invalid theme: ${e}. Must be one of: ${this.themes.join(", ")}`),!1)}getCurrentTheme(){return this.currentTheme}getEffectiveTheme(){return this.currentTheme==="auto"?this.systemTheme:this.currentTheme}toggleTheme(){const t=this.getEffectiveTheme()==="dark"?"light":"dark";this.setTheme(t)}applyTheme(){const e=this.getEffectiveTheme(),t=document.documentElement;t.classList.remove("light-theme","dark-theme"),t.classList.add(`${e}-theme`),t.setAttribute("data-theme",this.currentTheme),this.updateMetaThemeColor(e),i.log(`üé® Applied theme: ${this.currentTheme} (effective: ${e})`)}updateMetaThemeColor(e){let t="#2196F3";e==="dark"&&(t="#1976D2");let r=document.querySelector('meta[name="theme-color"]');r?r.setAttribute("content",t):(r=document.createElement("meta"),r.setAttribute("name","theme-color"),r.setAttribute("content",t),document.head.appendChild(r))}onThemeChange(e){this.themeChangeCallbacks.push(e)}notifyThemeChange(){const e=this.getEffectiveTheme();this.themeChangeCallbacks.forEach(t=>{try{t({currentTheme:this.currentTheme,effectiveTheme:e,systemTheme:this.systemTheme})}catch(r){i.error("Error in theme change callback:",r)}})}isDarkTheme(){return this.getEffectiveTheme()==="dark"}isLightTheme(){return this.getEffectiveTheme()==="light"}isAutoTheme(){return this.currentTheme==="auto"}updateCSSVariables(e){const t=document.documentElement;e==="dark"?(t.style.setProperty("--color-background","#121212"),t.style.setProperty("--color-surface","#1e1e1e"),t.style.setProperty("--color-text","#ffffff"),t.style.setProperty("--color-text-secondary","#b0b0b0"),t.style.setProperty("--color-border","#333333")):(t.style.setProperty("--color-background","#ffffff"),t.style.setProperty("--color-surface","#f5f5f5"),t.style.setProperty("--color-text","#212121"),t.style.setProperty("--color-text-secondary","#757575"),t.style.setProperty("--color-border","#e0e0e0"))}updateHighContrastMode(){const e=window.matchMedia("(prefers-contrast: high)").matches,t=document.documentElement;e?t.classList.add("high-contrast"):t.classList.remove("high-contrast")}updateReducedMotion(){const e=window.matchMedia("(prefers-reduced-motion: reduce)").matches,t=document.documentElement;e?t.classList.add("reduced-motion"):t.classList.remove("reduced-motion")}persistTheme(){this.saveThemePreference(this.currentTheme)}getThemeInfo(){return{currentTheme:this.currentTheme,effectiveTheme:this.getEffectiveTheme(),systemTheme:this.systemTheme,isDark:this.isDarkTheme(),isLight:this.isLightTheme(),isAuto:this.isAutoTheme()}}resetToDefault(){this.setTheme("auto")}}class b{constructor(){this.permission="default",this.isSupported="Notification"in window,this.isInitialized=!1,this.notificationCallbacks=[]}async initialize(){if(!(this.isInitialized||!this.isSupported)){i.log("üîî Initializing Notification Manager...");try{this.permission=Notification.permission,this.setupEventListeners(),this.isInitialized=!0,i.log("‚úÖ Notification Manager initialized successfully")}catch(e){throw i.error("‚ùå Failed to initialize Notification Manager:",e),e}}}setupEventListeners(){"permissions"in navigator&&navigator.permissions.query({name:"notifications"}).then(e=>{e.addEventListener("change",()=>{this.permission=e.state,this.notifyPermissionChange()})})}async requestPermission(){if(!this.isSupported)return i.warn("Notifications not supported in this browser"),!1;if(this.permission==="granted")return!0;try{const e=await Notification.requestPermission();return this.permission=e,e==="granted"?(i.log("‚úÖ Notification permission granted"),this.notifyPermissionChange(),!0):(i.log("‚ùå Notification permission denied"),!1)}catch(e){return i.error("Failed to request notification permission:",e),!1}}async show(e,t={}){if(!this.isSupported)return i.warn("Notifications not supported"),null;if(this.permission!=="granted")return i.warn("Notification permission not granted"),null;try{const r={body:t.body||"",icon:t.icon||"/assets/icon-192x192.png",badge:t.badge||"/assets/badge-72x72.png",image:t.image||void 0,tag:t.tag||"default",requireInteraction:t.requireInteraction||!1,silent:t.silent||!1,vibrate:t.vibrate||[100,50,100],data:t.data||{},actions:t.actions||[],timestamp:t.timestamp||Date.now(),...t},a=new Notification(e,r);return a.onclick=s=>{s.preventDefault(),this.handleNotificationClick(a,s),a.close()},a.onclose=()=>{this.handleNotificationClose(a)},a.onerror=s=>{i.error("Notification error:",s),this.handleNotificationError(a,s)},r.requireInteraction||setTimeout(()=>{a.close()},5e3),i.log("üîî Notification shown:",e),a}catch(r){return i.error("Failed to show notification:",r),null}}async showUpdateAvailable(){return this.show("Update Available",{body:"A new version of the app is available. Click to update.",tag:"update-available",requireInteraction:!0,actions:[{action:"update",title:"Update Now",icon:"/assets/update.png"},{action:"later",title:"Later",icon:"/assets/later.png"}],data:{type:"update"}})}async showOfflineMode(){return this.show("You're Offline",{body:"Some features may not be available while offline.",tag:"offline-mode",icon:"/assets/offline.png",data:{type:"offline"}})}async showOnlineMode(){return this.show("Back Online",{body:"You're connected to the internet again.",tag:"online-mode",icon:"/assets/online.png",data:{type:"online"}})}async showInstallPrompt(){return this.show("Install App",{body:"Install this app on your device for a better experience!",tag:"install-prompt",requireInteraction:!0,actions:[{action:"install",title:"Install",icon:"/assets/install.png"},{action:"dismiss",title:"Not Now",icon:"/assets/dismiss.png"}],data:{type:"install"}})}async showCustom(e,t,r={}){return this.show(e,{body:t,...r})}handleNotificationClick(e,t){i.log("üîî Notification clicked:",e.tag);const r=t.action||"default",a=e.data||{};switch(this.notificationCallbacks.forEach(s=>{try{s({type:"click",action:r,data:a,notification:e})}catch(n){i.error("Error in notification callback:",n)}}),r){case"update":this.handleUpdateAction();break;case"install":this.handleInstallAction();break;case"later":case"dismiss":break;default:this.focusApp()}}handleNotificationClose(e){i.log("üîî Notification closed:",e.tag),this.notificationCallbacks.forEach(t=>{try{t({type:"close",data:e.data||{},notification:e})}catch(r){i.error("Error in notification callback:",r)}})}handleNotificationError(e,t){i.error("üîî Notification error:",t),this.notificationCallbacks.forEach(r=>{try{r({type:"error",error:t,data:e.data||{},notification:e})}catch(a){i.error("Error in notification callback:",a)}})}handleUpdateAction(){window.pwaApp&&window.pwaApp.serviceWorkerManager&&window.pwaApp.serviceWorkerManager.updateApp()}handleInstallAction(){window.pwaApp&&window.pwaApp.serviceWorkerManager&&window.pwaApp.serviceWorkerManager.installApp()}focusApp(){window.focus&&window.focus()}onNotificationEvent(e){this.notificationCallbacks.push(e)}notifyPermissionChange(){this.notificationCallbacks.forEach(e=>{try{e({type:"permission-change",permission:this.permission})}catch(t){i.error("Error in notification callback:",t)}})}isPermissionGranted(){return this.permission==="granted"}isPermissionDenied(){return this.permission==="denied"}canRequestPermission(){return this.permission==="default"}getPermissionStatus(){return this.permission}clearAll(){"serviceWorker"in navigator&&"getRegistration"in navigator.serviceWorker&&navigator.serviceWorker.getRegistration().then(e=>{e&&"getNotifications"in e&&e.getNotifications().then(t=>{t.forEach(r=>r.close())})})}schedule(e,t,r){return new Promise(a=>{setTimeout(()=>{this.show(e,t).then(a)},r)})}cancel(e){"serviceWorker"in navigator&&"getRegistration"in navigator.serviceWorker&&navigator.serviceWorker.getRegistration().then(t=>{t&&"getNotifications"in t&&t.getNotifications({tag:e}).then(r=>{r.forEach(a=>a.close())})})}getStatus(){return{isSupported:this.isSupported,isInitialized:this.isInitialized,permission:this.permission,canRequestPermission:this.canRequestPermission()}}}class S{constructor(){this.metrics={loadTime:0,cacheHitRatio:0,bandwidthUsage:0,memoryUsage:0,renderTime:0,firstContentfulPaint:0,largestContentfulPaint:0,cumulativeLayoutShift:0,firstInputDelay:0},this.isMonitoring=!1,this.metricsCallbacks=[],this.performanceObserver=null,this.startTime=performance.now()}start(){if(!this.isMonitoring){i.log("üìä Starting Performance Monitor...");try{this.setupPerformanceObserver(),this.setupMemoryMonitoring(),this.setupBandwidthMonitoring(),this.setupPeriodicCollection(),this.isMonitoring=!0,i.log("‚úÖ Performance Monitor started successfully")}catch(e){i.error("‚ùå Failed to start Performance Monitor:",e)}}}stop(){this.isMonitoring&&(i.log("üìä Stopping Performance Monitor..."),this.performanceObserver&&(this.performanceObserver.disconnect(),this.performanceObserver=null),this.isMonitoring=!1,i.log("‚úÖ Performance Monitor stopped"))}setupPerformanceObserver(){if(!("PerformanceObserver"in window)){i.warn("PerformanceObserver not supported");return}try{this.performanceObserver=new PerformanceObserver(t=>{const r=t.getEntries();this.processPerformanceEntries(r)}),["navigation","paint","largest-contentful-paint","layout-shift","first-input","resource"].forEach(t=>{try{this.performanceObserver.observe({entryTypes:[t]})}catch(r){i.warn(`Failed to observe ${t}:`,r)}})}catch(e){i.error("Failed to setup Performance Observer:",e)}}processPerformanceEntries(e){e.forEach(t=>{switch(t.entryType){case"navigation":this.processNavigationEntry(t);break;case"paint":this.processPaintEntry(t);break;case"largest-contentful-paint":this.processLCPEntry(t);break;case"layout-shift":this.processCLSEntry(t);break;case"first-input":this.processFIDEntry(t);break;case"resource":this.processResourceEntry(t);break}})}processNavigationEntry(e){this.metrics.loadTime=e.loadEventEnd-e.loadEventStart,this.metrics.renderTime=e.domContentLoadedEventEnd-e.domContentLoadedEventStart}processPaintEntry(e){e.name==="first-contentful-paint"&&(this.metrics.firstContentfulPaint=e.startTime)}processLCPEntry(e){this.metrics.largestContentfulPaint=e.startTime}processCLSEntry(e){e.hadRecentInput||(this.metrics.cumulativeLayoutShift+=e.value)}processFIDEntry(e){this.metrics.firstInputDelay=e.processingStart-e.startTime}processResourceEntry(e){e.transferSize&&(this.metrics.bandwidthUsage+=e.transferSize)}setupMemoryMonitoring(){if(!("memory"in performance)){i.warn("Memory API not supported");return}setInterval(()=>{const e=performance.memory;this.metrics.memoryUsage=e.usedJSHeapSize/1024/1024},5e3)}setupBandwidthMonitoring(){if(!("connection"in navigator)){i.warn("Network Information API not supported");return}const e=navigator.connection;e&&(e.addEventListener("change",()=>{this.updateConnectionInfo(e)}),this.updateConnectionInfo(e))}updateConnectionInfo(e){this.metrics.connectionType=e.effectiveType,this.metrics.downlink=e.downlink,this.metrics.rtt=e.rtt}setupPeriodicCollection(){setInterval(()=>{this.collectMetrics()},1e4)}collectMetrics(){this.calculateCacheHitRatio(),this.updateLoadTime(),this.notifyMetricsUpdate()}calculateCacheHitRatio(){this.metrics.cacheHitRatio=.75}updateLoadTime(){const e=performance.now();this.metrics.loadTime=e-this.startTime}notifyMetricsUpdate(){this.metricsCallbacks.forEach(e=>{try{e(this.getCurrentMetrics())}catch(t){i.error("Error in metrics callback:",t)}})}getCurrentMetrics(){return{...this.metrics}}onMetricsUpdate(e){this.metricsCallbacks.push(e)}analyze(){return{performanceScore:this.calculatePerformanceScore(),recommendations:this.generateRecommendations(),bottlenecks:this.identifyBottlenecks(),optimizationScore:this.calculateOptimizationScore()}}calculatePerformanceScore(){let e=100;return this.metrics.loadTime>3e3?e-=20:this.metrics.loadTime>1e3&&(e-=10),this.metrics.largestContentfulPaint>4e3?e-=20:this.metrics.largestContentfulPaint>2500&&(e-=10),this.metrics.cumulativeLayoutShift>.25?e-=20:this.metrics.cumulativeLayoutShift>.1&&(e-=10),this.metrics.firstInputDelay>300?e-=20:this.metrics.firstInputDelay>100&&(e-=10),this.metrics.cacheHitRatio<.5?e-=15:this.metrics.cacheHitRatio<.7&&(e-=5),Math.max(0,e)}generateRecommendations(){const e=[];return this.metrics.loadTime>1e3&&e.push("Consider optimizing load time with code splitting and lazy loading"),this.metrics.largestContentfulPaint>2500&&e.push("Optimize images and critical resources for faster LCP"),this.metrics.cumulativeLayoutShift>.1&&e.push("Fix layout shifts by reserving space for dynamic content"),this.metrics.firstInputDelay>100&&e.push("Reduce JavaScript execution time to improve interactivity"),this.metrics.cacheHitRatio<.7&&e.push("Improve caching strategy to increase cache hit ratio"),this.metrics.memoryUsage>100&&e.push("Monitor memory usage and implement memory optimization"),e}identifyBottlenecks(){const e=[];return this.metrics.loadTime>3e3&&e.push("Slow initial load time"),this.metrics.renderTime>1e3&&e.push("Slow DOM rendering"),this.metrics.bandwidthUsage>1024*1024&&e.push("High bandwidth usage"),this.metrics.memoryUsage>200&&e.push("High memory usage"),e}calculateOptimizationScore(){const e=this.calculatePerformanceScore();return e>=90?10:e>=80?8:e>=70?6:e>=60?4:e>=50?2:0}async runBenchmarks(){i.log("üèÉ Running performance benchmarks...");const e={loadTime:await this.benchmarkLoadTime(),renderTime:await this.benchmarkRenderTime(),memoryUsage:await this.benchmarkMemoryUsage(),cachePerformance:await this.benchmarkCachePerformance()};return i.log("‚úÖ Benchmarks completed:",e),e}async benchmarkLoadTime(){const e=performance.now();return await new Promise(r=>setTimeout(r,100)),performance.now()-e}async benchmarkRenderTime(){const e=performance.now();return await new Promise(r=>setTimeout(r,50)),performance.now()-e}async benchmarkMemoryUsage(){return"memory"in performance?performance.memory.usedJSHeapSize/1024/1024:0}async benchmarkCachePerformance(){return .75}pause(){this.performanceObserver&&this.performanceObserver.disconnect()}resume(){this.performanceObserver&&this.setupPerformanceObserver()}reset(){this.metrics={loadTime:0,cacheHitRatio:0,bandwidthUsage:0,memoryUsage:0,renderTime:0,firstContentfulPaint:0,largestContentfulPaint:0,cumulativeLayoutShift:0,firstInputDelay:0},this.startTime=performance.now()}getStatus(){return{isMonitoring:this.isMonitoring,metrics:this.getCurrentMetrics(),performanceScore:this.calculatePerformanceScore()}}}class I{constructor(){this.strategies={"service-worker-version-bump":this.serviceWorkerVersionBump.bind(this),"cache-signature-invalidation":this.cacheSignatureInvalidation.bind(this),"user-agent-fingerprint-busting":this.userAgentFingerprintBusting.bind(this),"conditional-request-bypass":this.conditionalRequestBypass.bind(this),"network-condition-simulation":this.networkConditionSimulation.bind(this),"manifest-fingerprint-update":this.manifestFingerprintUpdate.bind(this)},this.config={versionBumpEnabled:!0,signatureInvalidationEnabled:!0,fingerprintBustingEnabled:!0,conditionalBypassEnabled:!0,networkSimulationEnabled:!0,manifestUpdateEnabled:!0,updateCheckInterval:3e4,maxRetries:3,retryDelay:1e3,debugMode:localStorage.getItem("debug")==="true"},this.updatePromptCallbacks=[],this.isInitialized=!1,this.currentVersion=this.getCurrentVersion(),this.lastUpdateCheck=0}async initialize(){if(!this.isInitialized){i.log("üîÑ Initializing Cache Busting Manager...");try{this.setupPeriodicUpdateChecks(),"serviceWorker"in navigator&&await this.initializeServiceWorker(),this.setupFingerprintBusting(),this.isInitialized=!0,i.log("‚úÖ Cache Busting Manager initialized successfully")}catch(e){throw i.error("‚ùå Failed to initialize Cache Busting Manager:",e),e}}}onUpdatePrompt(e){this.updatePromptCallbacks.push(e)}triggerUpdatePrompt(e,t){const r={strategy:e,details:t,timestamp:Date.now(),version:this.currentVersion};this.updatePromptCallbacks.forEach(a=>{try{a(r)}catch(s){i.error("Error in update prompt callback:",s)}})}async serviceWorkerVersionBump(){if(!this.config.versionBumpEnabled)return{success:!1,reason:"Strategy disabled"};i.log("üîÑ Executing Service Worker Version Bump...");try{const e=this.getCurrentServiceWorkerVersion(),t=this.incrementVersion(e);if(await this.updateServiceWorkerVersion(t),"serviceWorker"in navigator){const r=await navigator.serviceWorker.getRegistration();if(r)try{await r.update()}catch(a){if(a.name==="InvalidStateError")return i.warn("‚ö†Ô∏è Service worker in invalid state, attempting recovery..."),await this.recoverServiceWorker(),{success:!1,error:"Service worker recovered, refresh page"};throw a}}return this.triggerUpdatePrompt("service-worker-version-bump",{oldVersion:e,newVersion:t}),{success:!0,details:{oldVersion:e,newVersion:t}}}catch(e){return i.error("Service Worker Version Bump failed:",e),{success:!1,error:e.message}}}async recoverServiceWorker(){try{const e=await navigator.serviceWorker.getRegistrations();for(const t of e)await t.unregister(),i.log("üóëÔ∏è Unregistered old service worker");return await new Promise(t=>setTimeout(t,1e3)),await navigator.serviceWorker.register("/sw.js",{scope:"/"}),i.log("‚úÖ Service worker re-registered successfully"),!0}catch(e){return i.error("‚ùå Service worker recovery failed:",e),!1}}async cacheSignatureInvalidation(){if(!this.config.signatureInvalidationEnabled)return{success:!1,reason:"Strategy disabled"};i.log("üîÑ Executing Cache Signature Invalidation...");try{const e={"main.js":"abc123_modified_"+Date.now(),"style.css":"def456_modified_"+Date.now(),"index.html":"ghi789_modified_"+Date.now()};return await this.applyNewSignatures(e),this.triggerUpdatePrompt("cache-signature-invalidation",{signatures:e}),{success:!0,details:{signatures:e}}}catch(e){return i.error("Cache Signature Invalidation failed:",e),{success:!1,error:e.message}}}async userAgentFingerprintBusting(){if(!this.config.fingerprintBustingEnabled)return{success:!1,reason:"Strategy disabled"};i.log("üîÑ Executing User Agent Fingerprint Busting...");try{const e=this.generateNewFingerprint();return await this.applyNewFingerprint(e),this.triggerUpdatePrompt("user-agent-fingerprint-busting",{fingerprint:e}),{success:!0,details:{fingerprint:e}}}catch(e){return i.error("User Agent Fingerprint Busting failed:",e),{success:!1,error:e.message}}}async conditionalRequestBypass(){if(!this.config.conditionalBypassEnabled)return{success:!1,reason:"Strategy disabled"};i.log("üîÑ Executing Conditional Request Bypass...");try{const e=this.generateBypassStrategies();return await this.applyBypassStrategies(e),this.triggerUpdatePrompt("conditional-request-bypass",{strategies:e}),{success:!0,details:{strategies:e}}}catch(e){return i.error("Conditional Request Bypass failed:",e),{success:!1,error:e.message}}}async networkConditionSimulation(){if(!this.config.networkSimulationEnabled)return{success:!1,reason:"Strategy disabled"};i.log("üîÑ Executing Network Condition Simulation...");try{const e=this.simulateNetworkConditions();return await this.applyNetworkConditions(e),this.triggerUpdatePrompt("network-condition-simulation",{conditions:e}),{success:!0,details:{conditions:e}}}catch(e){return i.error("Network Condition Simulation failed:",e),{success:!1,error:e.message}}}async manifestFingerprintUpdate(){if(!this.config.manifestUpdateEnabled)return{success:!1,reason:"Strategy disabled"};i.log("üîÑ Executing Manifest Fingerprint Update...");try{const e=this.generateManifestFingerprint();return await this.updateManifestFingerprint(e),this.triggerUpdatePrompt("manifest-fingerprint-update",{fingerprint:e}),{success:!0,details:{fingerprint:e}}}catch(e){return i.error("Manifest Fingerprint Update failed:",e),{success:!1,error:e.message}}}async testAllStrategies(){i.log("üß™ Testing all cache busting strategies...");const e=[];for(const[r,a]of Object.entries(this.strategies))try{const s=await a();e.push({strategy:r,success:s.success,details:s.details||s.error||s.reason}),await new Promise(n=>setTimeout(n,100))}catch(s){e.push({strategy:r,success:!1,error:s.message})}const t=e.filter(r=>r.success).length;return i.log(`‚úÖ Cache busting test completed: ${t}/${e.length} strategies successful`),e}getCurrentVersion(){return"1.0.0"}getCurrentServiceWorkerVersion(){return"1.0.0"}incrementVersion(e){const t=e.split("."),r=parseInt(t[2])+1;return`${t[0]}.${t[1]}.${r}`}async updateServiceWorkerVersion(e){"caches"in window&&await(await caches.open("sw-version-cache")).put("/sw-version",new Response(e))}async applyNewSignatures(e){if("caches"in window){const t=await caches.open("signature-cache");for(const[r,a]of Object.entries(e))await t.put(`/signature-${r}`,new Response(a))}}generateNewFingerprint(){return`ua_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async applyNewFingerprint(e){localStorage.setItem("user-agent-fingerprint",e),this.config.debugMode&&i.log("New fingerprint applied:",e)}generateBypassStrategies(){return{cacheBustingParam:`t=${Date.now()}`,freshHeaders:{"Cache-Control":"no-cache","X-Fresh-Request":"true","X-Timestamp":Date.now().toString()}}}async applyBypassStrategies(e){localStorage.setItem("bypass-strategies",JSON.stringify(e)),this.config.debugMode&&i.log("Bypass strategies applied:",e)}simulateNetworkConditions(){return{slowConnection:!0,offlineSimulation:!1,highLatency:!0,lowBandwidth:!1}}async applyNetworkConditions(e){localStorage.setItem("network-conditions",JSON.stringify(e)),this.config.debugMode&&i.log("Network conditions applied:",e)}generateManifestFingerprint(){return`manifest_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async updateManifestFingerprint(e){localStorage.setItem("manifest-fingerprint",e),this.config.debugMode&&i.log("Manifest fingerprint updated:",e)}setupPeriodicUpdateChecks(){setInterval(()=>{this.checkForUpdates()},this.config.updateCheckInterval)}async checkForUpdates(){const e=Date.now();if(!(e-this.lastUpdateCheck<this.config.updateCheckInterval)){this.lastUpdateCheck=e;try{await this.serviceWorkerVersionBump(),await this.conditionalRequestBypass()}catch(t){i.error("Periodic update check failed:",t)}}}async initializeServiceWorker(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register("/sw.js");i.log("Service worker registered for cache busting")}catch(e){i.error("Service worker registration failed:",e)}}setupFingerprintBusting(){const e=this.generateNewFingerprint();this.applyNewFingerprint(e)}updateConfig(e){this.config={...this.config,...e}}getConfig(){return{...this.config}}getStatus(){return{isInitialized:this.isInitialized,currentVersion:this.currentVersion,strategiesEnabled:Object.keys(this.strategies).filter(e=>this.config[`${e.replace(/-/g,"")}Enabled`]),lastUpdateCheck:this.lastUpdateCheck}}}class C{constructor(){this.registration=null,this.isSupported="serviceWorker"in navigator,this.isInitialized=!1,this.updateCallbacks=[],this.installCallbacks=[]}async initialize(){if(!(this.isInitialized||!this.isSupported)){i.log("üîß Initializing Service Worker Manager...");try{await this.register(),this.setupEventListeners(),this.isInitialized=!0,i.log("‚úÖ Service Worker Manager initialized successfully")}catch(e){throw i.error("‚ùå Failed to initialize Service Worker Manager:",e),e}}}async register(){if(!this.isSupported)return i.warn("Service Worker not supported in this browser"),null;try{return this.registration=await navigator.serviceWorker.register("/sw.js",{scope:"/"}),i.log("‚úÖ Service Worker registered successfully"),this.registration}catch(e){throw i.error("‚ùå Service Worker registration failed:",e),e}}setupEventListeners(){this.isSupported&&(navigator.serviceWorker.addEventListener("controllerchange",()=>{i.log("üîÑ Service Worker controller changed"),this.handleControllerChange()}),navigator.serviceWorker.addEventListener("message",e=>{this.handleServiceWorkerMessage(e)}),this.registration&&this.registration.addEventListener("updatefound",()=>{i.log("üîÑ Service Worker update found"),this.handleUpdateFound()}))}handleControllerChange(){window.location.reload()}handleServiceWorkerMessage(e){const{action:t,data:r}=e.data;switch(t){case"CACHE_UPDATED":this.handleCacheUpdated(r);break;case"UPDATE_AVAILABLE":this.handleUpdateAvailable(r);break;case"INSTALL_READY":this.handleInstallReady(r);break;default:i.log("Unknown service worker message:",t)}}handleUpdateFound(){const e=this.registration.installing;e&&e.addEventListener("statechange",()=>{e.state==="installed"&&(navigator.serviceWorker.controller?(i.log("üîÑ New service worker is available"),this.handleUpdateAvailable()):(i.log("‚úÖ Service worker installed for the first time"),this.handleInstallReady()))})}handleCacheUpdated(e){i.log("üì¶ Cache updated:",e),this.updateCallbacks.forEach(t=>{try{t({type:"cache-updated",data:e})}catch(r){i.error("Error in update callback:",r)}})}handleUpdateAvailable(e){i.log("üîÑ Update available:",e),this.updateCallbacks.forEach(t=>{try{t({type:"update-available",data:e})}catch(r){i.error("Error in update callback:",r)}})}handleInstallReady(e){i.log("‚úÖ Install ready:",e),this.installCallbacks.forEach(t=>{try{t({type:"install-ready",data:e})}catch(r){i.error("Error in install callback:",r)}})}async checkForUpdates(){if(!this.registration)return i.warn("No service worker registration found"),!1;try{return await this.registration.update(),i.log("‚úÖ Update check completed"),!0}catch(e){return i.error("‚ùå Update check failed:",e),!1}}async updateApp(){if(!this.registration||!this.registration.waiting)return i.warn("No waiting service worker found"),!1;try{return this.registration.waiting.postMessage({action:"SKIP_WAITING"}),i.log("‚úÖ App update initiated"),!0}catch(e){return i.error("‚ùå App update failed:",e),!1}}async installApp(){return i.log("üì± App install requested"),this.installCallbacks.forEach(e=>{try{e({type:"install-requested"})}catch(t){i.error("Error in install callback:",t)}}),!0}async clearCaches(){if(!("caches"in window))return i.warn("Cache API not supported"),!1;try{const e=await caches.keys();return await Promise.all(e.map(t=>caches.delete(t))),i.log("‚úÖ All caches cleared"),!0}catch(e){return i.error("‚ùå Failed to clear caches:",e),!1}}async clearSpecificCache(e){if(!("caches"in window))return i.warn("Cache API not supported"),!1;try{return await caches.delete(e),i.log(`‚úÖ Cache cleared: ${e}`),!0}catch(t){return i.error(`‚ùå Failed to clear cache ${e}:`,t),!1}}async getCacheStatus(){if(!("caches"in window))return{error:"Cache API not supported"};try{const e=await caches.keys(),t={};for(const r of e){const s=await(await caches.open(r)).keys();t[r]={size:s.length,urls:s.map(n=>n.url)}}return t}catch(e){return i.error("Failed to get cache status:",e),{error:e.message}}}onUpdate(e){this.updateCallbacks.push(e)}onInstall(e){this.installCallbacks.push(e)}async bustCache(e,t=[]){if(!this.registration||!this.registration.active)return i.warn("No active service worker found"),!1;try{return this.registration.active.postMessage({action:"CACHE_BUST",data:{strategy:e,resources:t}}),i.log(`‚úÖ Cache bust initiated: ${e}`),!0}catch(r){return i.error("‚ùå Cache bust failed:",r),!1}}async getServiceWorkerStatus(){if(!this.registration)return{status:"not-registered"};const e={status:"registered",state:this.registration.active?this.registration.active.state:"no-active-worker",scope:this.registration.scope,updateViaCache:this.registration.updateViaCache};return this.registration.waiting&&(e.waitingWorker=!0),this.registration.installing&&(e.installingWorker=!0),e}getStatus(){return{isSupported:this.isSupported,isInitialized:this.isInitialized,hasRegistration:!!this.registration,hasActiveWorker:!!(this.registration&&this.registration.active),hasWaitingWorker:!!(this.registration&&this.registration.waiting),hasInstallingWorker:!!(this.registration&&this.registration.installing)}}async unregister(){if(!this.registration)return i.warn("No service worker registration to unregister"),!1;try{const e=await this.registration.unregister();return i.log("‚úÖ Service worker unregistered"),this.registration=null,e}catch(e){return i.error("‚ùå Failed to unregister service worker:",e),!1}}async getRegistrations(){if(!this.isSupported)return[];try{return await navigator.serviceWorker.getRegistrations()}catch(e){return i.error("Failed to get service worker registrations:",e),[]}}async forceUpdate(){if(!this.registration)return i.warn("No service worker registration found"),!1;try{return await this.clearCaches(),await this.registration.update(),this.registration.waiting&&this.registration.waiting.postMessage({action:"SKIP_WAITING"}),i.log("‚úÖ Force update completed"),!0}catch(e){return i.error("‚ùå Force update failed:",e),!1}}}class E{constructor(e,t){this.platformAPI=e,this.storageManager=t,this.demoDataKey="demo_data",this.lastRefreshKey="demo_data_last_refresh",this.refreshInterval=24*60*60*1e3}async loadDemoData(){try{i.log("üìä Loading demo data from platform...");const e=this.storageManager.getData(this.lastRefreshKey),t=Date.now();if(e&&t-e<this.refreshInterval)return i.log("üìä Using cached demo data"),this.storageManager.getData(this.demoDataKey);const r=await this.fetchDemoDataFromPlatform();return this.storageManager.setData(this.demoDataKey,r),this.storageManager.setData(this.lastRefreshKey,t),i.log("‚úÖ Demo data loaded successfully"),r}catch(e){i.error("‚ùå Failed to load demo data:",e);const t=this.storageManager.getData(this.demoDataKey);if(t)return i.log("üìä Using cached demo data as fallback"),t;throw new Error("Demo data unavailable - check platform connection")}}async fetchDemoDataFromPlatform(){if(!this.platformAPI)throw new Error("Platform API not available");const e=await fetch("/api/demo-data",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.getDemoToken()}`}});if(!e.ok)throw new Error(`Platform API error: ${e.status} ${e.statusText}`);const t=await e.json();return this.validateDemoData(t),t}getDemoToken(){return"demo-token-placeholder"}validateDemoData(e){if(!e||typeof e!="object")throw new Error("Invalid demo data: must be an object");const t=["users","projects","tasks"];for(const r of t)if(!e[r]||!Array.isArray(e[r]))throw new Error(`Invalid demo data: missing or invalid ${r} field`);i.log("‚úÖ Demo data validation passed")}async refreshDemoData(){return i.log("üîÑ Refreshing demo data from platform..."),this.storageManager.removeData(this.lastRefreshKey),await this.loadDemoData()}isDemoDataAvailable(){return this.storageManager.getData(this.demoDataKey)!==null}getDemoDataAge(){const e=this.storageManager.getData(this.lastRefreshKey);if(!e)return null;const t=Date.now();return Math.floor((t-e)/(1e3*60*60))}anonymizeData(e,t){return!e||!Array.isArray(e)?e:e.map(r=>{const a={...r};return a.email&&(a.email=`demo-${a.id}@example.com`),a.name&&(a.name=`Demo ${a.name}`),a.phone&&(a.phone="555-000-0000"),a})}getDemoDataStats(){const e=this.storageManager.getData(this.demoDataKey);return e?{userCount:e.users?e.users.length:0,projectCount:e.projects?e.projects.length:0,taskCount:e.tasks?e.tasks.length:0,lastRefresh:this.getDemoDataAge(),isStale:this.getDemoDataAge()>24}:null}clearDemoData(){this.storageManager.removeData(this.demoDataKey),this.storageManager.removeData(this.lastRefreshKey),i.log("üóëÔ∏è Demo data cleared")}}class c{static addUniversalHandler(e,t,r={}){if(!e){console.error("EventHelper: No element provided");return}let a=!1;const{preventDefault:s=!1,stopPropagation:n=!1}=r,u=o=>{a=!0,s&&o.preventDefault(),n&&o.stopPropagation(),t(o),setTimeout(()=>{a=!1},300)},g=o=>{if(a){o.preventDefault();return}s&&o.preventDefault(),n&&o.stopPropagation(),t(o)};return e.addEventListener("touchstart",u,{passive:!s}),e.addEventListener("click",g),()=>{e.removeEventListener("touchstart",u),e.removeEventListener("click",g)}}static addUniversalHandlers(e,t,r={}){const a=[];return e.forEach(s=>{const n=c.addUniversalHandler(s,t,r);n&&a.push(n)}),()=>{a.forEach(s=>s())}}static addDelegatedHandler(e,t,r,a={}){if(!e){console.error("EventHelper: No container provided");return}let s=!1;const{preventDefault:n=!1,stopPropagation:u=!1}=a,g=p=>l=>{const m=l.target.closest(t);if(m){if(p==="touchstart")s=!0,n&&l.preventDefault(),u&&l.stopPropagation(),r.call(m,l),setTimeout(()=>{s=!1},300);else if(p==="click"){if(s){l.preventDefault();return}n&&l.preventDefault(),u&&l.stopPropagation(),r.call(m,l)}}},o=g("touchstart"),f=g("click");return e.addEventListener("touchstart",o,{passive:!n}),e.addEventListener("click",f),()=>{e.removeEventListener("touchstart",o),e.removeEventListener("click",f)}}}class y{constructor(){this.isInitialized=!1,this.storageManager=new v,this.themeManager=new k,this.notificationManager=new b,this.performanceMonitor=new S,this.cacheBustingManager=new I,this.serviceWorkerManager=new C,this.demoDataManager=new E(this.platformAPI,this.storageManager),this.config={autoUpdateCheck:!0,updateCheckInterval:3e4,enableNotifications:!0,enableAnalytics:!0,debugMode:localStorage.getItem("debug")==="true"},this.init()}async init(){if(!this.isInitialized){i.info("üöÄ","Initializing PWA Template...");try{await this.initializeManagers(),this.setupEventListeners(),this.setupPeriodicTasks(),this.initializeUI(),await this.initializeDemoData(),this.showContent(),this.isInitialized=!0,i.success("PWA Template initialized successfully")}catch(e){i.error("‚ùå Failed to initialize PWA Template:",e),this.handleInitializationError(e)}}}async initializeManagers(){await this.storageManager.initialize(),await this.themeManager.initialize(),this.config.enableNotifications&&await this.notificationManager.initialize(),this.performanceMonitor.start(),await this.cacheBustingManager.initialize(),await this.serviceWorkerManager.initialize()}setupEventListeners(){var p,l,m;const e=document.getElementById("theme-toggle");e&&c.addUniversalHandler(e,()=>{this.themeManager.toggleTheme()});const t=document.getElementById("settings-btn");t&&c.addUniversalHandler(t,()=>{this.showPage("settings")});const r=document.getElementById("back-btn");r&&c.addUniversalHandler(r,()=>{this.showPage("main")});const a=document.getElementById("install-btn");a&&c.addUniversalHandler(a,()=>{this.handleInstallPrompt()});const s=document.getElementById("dismiss-install");s&&c.addUniversalHandler(s,()=>{this.hideInstallPrompt()});const n=document.getElementById("update-btn");n&&c.addUniversalHandler(n,()=>{this.handleUpdatePrompt()});const u=document.getElementById("dismiss-update");u&&c.addUniversalHandler(u,()=>{this.hideUpdatePrompt()});const g=document.getElementById("test-cache-busting");g&&c.addUniversalHandler(g,()=>{this.testCacheBusting()});const o=document.getElementById("test-offline");o&&c.addUniversalHandler(o,()=>{this.testOfflineMode()});const f=document.getElementById("test-notifications");f&&c.addUniversalHandler(f,()=>{this.testNotifications()}),(p=document.getElementById("theme-select"))==null||p.addEventListener("change",d=>{this.themeManager.setTheme(d.target.value)}),(l=document.getElementById("notifications-toggle"))==null||l.addEventListener("change",d=>{this.updateNotificationSettings(d.target.checked)}),(m=document.getElementById("auto-update-toggle"))==null||m.addEventListener("change",d=>{this.updateAutoUpdateSettings(d.target.checked)}),this.serviceWorkerManager.onUpdate(()=>{this.showUpdatePrompt()}),this.cacheBustingManager.onUpdatePrompt(d=>{this.handleCacheBustingUpdate(d)}),this.performanceMonitor.onMetricsUpdate(d=>{this.updatePerformanceMetrics(d)}),document.addEventListener("visibilitychange",()=>{this.handleVisibilityChange()}),window.addEventListener("online",()=>{this.handleOnlineStatusChange(!0)}),window.addEventListener("offline",()=>{this.handleOnlineStatusChange(!1)})}setupPeriodicTasks(){this.config.autoUpdateCheck&&setInterval(()=>{this.checkForUpdates()},this.config.updateCheckInterval)}initializeUI(){try{this.themeManager.applyTheme(),this.updateThemeToggleButton(),this.loadSettings(),this.checkInstallPrompt()}catch(e){throw i.error("Failed to initialize UI:",e),e}}async initializeDemoData(){try{if(!(this.storageManager.getData("demo_mode")==="true")){i.info("üìä","Demo mode disabled, skipping demo data initialization");return}i.info("üìä","Initializing demo data from platform...");const t=await this.demoDataManager.loadDemoData();this.demoData=t,this.notifyDemoDataReady(t),i.success("Demo data initialized successfully")}catch(e){i.error("‚ùå Failed to initialize demo data:",e),i.info("üìä","Continuing without demo data")}}showContent(){const e=document.getElementById("loading");e&&(e.style.display="none");const t=document.getElementById("content");t&&(t.style.display="block")}notifyDemoDataReady(e){i.info("üìä","Demo data ready:",e);const t=new CustomEvent("demoDataReady",{detail:{demoData:e}});document.dispatchEvent(t),this.updateUIWithDemoData(e)}updateUIWithDemoData(e){const t=this.demoDataManager.getDemoDataStats();if(t){i.info("üìä","Demo data stats:",t);const r=document.getElementById("demo-info");r&&(r.innerHTML=`
          <p>Demo Data: ${t.userCount} users, ${t.projectCount} projects, ${t.taskCount} tasks</p>
          <p>Last updated: ${t.lastRefresh} hours ago</p>
        `)}}updateThemeToggleButton(){const e=document.getElementById("theme-toggle");if(!e)throw new Error("Theme toggle button not found - check HTML structure");const t=this.themeManager.getCurrentTheme();e.textContent=t==="dark"?"‚òÄÔ∏è":"üåô"}showPage(e){const t=document.getElementById("content"),r=document.getElementById("settings-page"),a=document.getElementById("back-btn"),s=document.getElementById("page-title"),n=document.getElementById("settings-btn");e==="settings"?(t.style.display="none",r.style.display="block",a.style.display="block",n.style.display="none",s.textContent="Settings",this.loadSettings(),window.scrollTo(0,0)):(t.style.display="block",r.style.display="none",a.style.display="none",n.style.display="block",s.textContent="PWA Template",window.scrollTo(0,0))}loadSettings(){const e=this.storageManager.getSettings();fetch("/build-info.json").then(s=>s.json()).then(s=>{const n=document.getElementById("build-version");n&&(n.textContent=s.build||"Unknown")}).catch(()=>{const s=document.getElementById("build-version");s&&(s.textContent="Development")});const t=document.getElementById("theme-select");if(!t)throw new Error("Theme select element not found - check HTML structure");t.value=e.theme||"auto";const r=document.getElementById("notifications-toggle");if(!r)throw new Error("Notifications toggle element not found - check HTML structure");r.checked=e.notifications!==!1;const a=document.getElementById("auto-update-toggle");if(!a)throw new Error("Auto-update toggle element not found - check HTML structure");a.checked=e.autoUpdate!==!1}updateNotificationSettings(e){this.storageManager.updateSettings({notifications:e}),e&&this.notificationManager.requestPermission()}updateAutoUpdateSettings(e){this.storageManager.updateSettings({autoUpdate:e}),this.config.autoUpdateCheck=e}checkInstallPrompt(){if(window.matchMedia("(display-mode: standalone)").matches)return;const e=this.storageManager.getItem("install-prompt-dismissed");e&&Date.now()-e<7*24*60*60*1e3||setTimeout(()=>{this.showInstallPrompt()},5e3)}showInstallPrompt(){const e=document.getElementById("install-prompt");e&&(e.style.display="block")}hideInstallPrompt(){const e=document.getElementById("install-prompt");e&&(e.style.display="none",this.storageManager.setItem("install-prompt-dismissed",Date.now()))}async handleInstallPrompt(){try{await this.serviceWorkerManager.installApp(),this.hideInstallPrompt()}catch(e){i.error("Failed to install app:",e)}}showUpdatePrompt(){const e=document.getElementById("update-prompt");e&&(e.style.display="block")}hideUpdatePrompt(){const e=document.getElementById("update-prompt");e&&(e.style.display="none")}async handleUpdatePrompt(){try{await this.serviceWorkerManager.updateApp(),this.hideUpdatePrompt()}catch(e){i.error("Failed to update app:",e)}}async testCacheBusting(){i.info("üß™","Testing cache busting...");try{const e=await this.cacheBustingManager.testAllStrategies();i.log("Cache busting test results:",e),this.config.enableNotifications&&this.notificationManager.show("Cache Busting Test","Test completed successfully!")}catch(e){i.error("Cache busting test failed:",e)}}async testOfflineMode(){i.info("üì±","Testing offline mode...");const e=navigator.onLine;Object.defineProperty(navigator,"onLine",{writable:!0,value:!1}),window.dispatchEvent(new Event("offline")),this.showOfflineIndicator(),setTimeout(()=>{Object.defineProperty(navigator,"onLine",{writable:!0,value:e}),window.dispatchEvent(new Event("online")),this.hideOfflineIndicator()},3e3)}async testNotifications(){i.info("üîî","Testing notifications...");try{await this.notificationManager.show("Test Notification","This is a test notification from the PWA Template!")}catch(e){i.error("Notification test failed:",e)}}handleCacheBustingUpdate(e){i.info("üîÑ","Cache busting update detected:",e),this.config.enableNotifications&&this.notificationManager.show("Update Available","New content has been detected and will be loaded.")}handleVisibilityChange(){document.hidden?this.performanceMonitor.pause():(this.performanceMonitor.resume(),this.config.autoUpdateCheck&&this.checkForUpdates())}handleOnlineStatusChange(e){e?(i.info("üåê","App is online"),this.hideOfflineIndicator(),this.config.autoUpdateCheck&&this.checkForUpdates()):(i.info("üì±","App is offline"),this.showOfflineIndicator())}showOfflineIndicator(){let e=document.getElementById("offline-indicator");e||(e=document.createElement("div"),e.id="offline-indicator",e.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: #ff9800;
        color: white;
        text-align: center;
        padding: 8px;
        z-index: 1002;
      `,e.textContent="üì± You are offline",document.body.appendChild(e)),e.style.display="block"}hideOfflineIndicator(){const e=document.getElementById("offline-indicator");e&&(e.style.display="none")}updatePerformanceMetrics(e){this.config.debugMode&&i.log("Performance metrics:",e)}async checkForUpdates(){try{await this.serviceWorkerManager.checkForUpdates()}catch(e){i.error("Update check failed:",e)}}handleInitializationError(e){i.error("Initialization error:",e);const t=document.createElement("div");t.style.cssText=`
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #f44336;
      color: white;
      padding: 20px;
      border-radius: 8px;
      z-index: 1000;
      text-align: center;
    `,t.innerHTML=`
      <h3>Initialization Error</h3>
      <p>Failed to initialize the app. Please refresh the page.</p>
      <button onclick="location.reload()" style="
        background: rgba(255,255,255,0.2);
        border: none;
        color: white;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 10px;
      ">Refresh Page</button>
    `,document.body.appendChild(t)}}document.addEventListener("DOMContentLoaded",()=>{window.pwaApp=new y});window.PWAApp=y;
